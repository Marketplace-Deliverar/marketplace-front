import * as React from "react";

// Styles & context
import "../styles/index.css";
import ThemeContextProvider from "../context/ThemeContextProvider";
import { styled } from "@mui/material/styles";

// Custom components
import Footer from "../components/Footer";
import Navbar from "../components/Navbar";
import NavbarBusiness from "../components/NavbarBusiness";
import Login from "./Login";
import HomeBusiness from "./HomeBusiness";
import BusinessProducts from "./BusinessProducts";
import ScrollToTop from "../components/ScrollToTop";
import Inicio from "./Inicio";
import Empresas from "./Empresas";
import CompanyData from "./CompanyData";
import ProductDetail from "./ProductDetail";

// Components
import { CssBaseline } from "@mui/material";
import { BrowserRouter, Route, Routes } from "react-router-dom";

const StyledWrapper = styled(`div`)(({ theme }) => ({
  display: "flex",
  flexDirection: "column",
  minHeight: "100vh",
  top: 1, // Asegura que el contenedor se expanda verticalmente
}));

const App = () => {
  const domain = window.location.hostname;
  let content;

  const obtenerDatosEmpresa = (dominio) => {
    fetch(
      `https://xorn7asoxb4eecmwmszz5fbc3a0wamui.lambda-url.us-east-1.on.aws/empresas/url/${dominio}`,
      {
        method: "GET",
        headers: {
          Accept: "application/json",
        },
      }
    )
      .then((response) => {
        if (!response.ok) {
          throw new Error("Network response was not ok");
        }
        return response.json();
      })
      .then((data) => {
        // AquÃ­ puedes trabajar con los datos recibidos en formato JSON
        console.log(data);
      })
      .catch((error) => {
        console.error("Hubo un problema con la solicitud fetch:", error);
      });
  };

  console.log(domain);

  let datos = obtenerDatosEmpresa("carrefour.marketplace.deliver.ar");
  // let datos = obtenerDatosEmpresa(domain)
  content = (
    <Routes>
      <Route
        path="/*"
        element={
          domain.startsWith("localhost") ? (
            <Inicio />
          ) : (
            <HomeBusiness empresa={datos} />
          )
        }
      />
      <Route path="/login" element={<Login />} />
      <Route path="/empresas" element={<Empresas />} />
      <Route path="/empresa" element={<CompanyData />} />
      <Route path="/HomeBusiness" element={<HomeBusiness />} />
      <Route path="/BusinessProducts" element={<BusinessProducts />} />
      <Route path="/:cid/product/:pid" element={<ProductDetail />} />
    </Routes>
  );

  return (
    <ThemeContextProvider>
      <CssBaseline />
      <header>
        <title>Deliver.ar</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/logo.svg" />
      </header>
      <BrowserRouter>
        <StyledWrapper>
          <Navbar />
          <ScrollToTop />
          {content}
        </StyledWrapper>
        <Footer />
      </BrowserRouter>
    </ThemeContextProvider>
  );
};

export default App;
